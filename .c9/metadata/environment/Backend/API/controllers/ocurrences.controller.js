{"changed":true,"filter":false,"title":"ocurrences.controller.js","tooltip":"/Backend/API/controllers/ocurrences.controller.js","value":"//função de leitura que retorna o resultado no callback\n\nconst con = require(\"../config/connect\");\n\n\nexports.read = function(req, res) {\n\n\n    con.query('SELECT * from Occurrences', function(err, rows, fields) {\n        if (!err) {\n\n            if (rows.length == 0) {\n                res.status(404).send(\"Data nao encontrada\");\n            }\n            else {\n                res.status(200).send(rows);\n            }\n        }\n        else\n            console.log('Error while performing Query.', err);\n    });\n}\n\n\nexports.readID = function(req, res) {\n\n    const codigo = req.params.cod_occurence;\n    const post = {\n        cod_occurence: codigo\n    };\n    con.query('SELECT * from Occurrences where cod_occurence=?', post, function(err, rows, fields) {\n        if (!err) {\n\n            if (rows.length == 0) {\n                res.status(404).send({\n                    \"msg\": \"data not found\"\n                });\n            }\n            else {\n                res.status(200).send(rows);\n            }\n        }\n        else\n            res.status(400).send({\n                \"msg\": err.code\n            });\n        console.log('Error while performing Query.', err);\n    });\n}\n\n\nexports.save = function(req, res) {\n    const codigo = req.params.cod_occurence;\n    const request = req.sanitize('id_request').escape();\n    const departure = req.sanitize('departure_time').escape();\n    const arrival = req.sanitize('arrival_time').escape();\n    const casualties = req.sanitize('n_casualties').escape();\n    const ingered = req.sanitize('n_ingered').escape();\n    const location = req.sanitize('location').escape();\n    const terrain = req.sanitize('terrain_state').escape();\n    const cost = req.sanitize('total_cost').escape();\n    const notes = req.sanitize('notes').escape();\n    var query = \"\";\n        var post = {\n            cod_occurrence: codigo,\n            id_request: request,\n            departure_time: departure,\n            arrival_time: arrival,\n            n_casualties: casualties,\n            n_ingered: ingered,\n            location: location,\n            terrain_state: terrain,\n            total_cost: cost,\n            notes: notes\n        }\n        query = con.query('INSERT INTO Occurrences SET ?', post, function(err, rows, fields) {\n            console.log(query.sql);\n            if (!err) {\n                res.status(200).location(rows.insertId).send({\n                    \"msg\": \"inserted with success\"\n                });\n                console.log(\"Number of records inserted: \" + rows.affectedRows);\n            }\n            else {\n                if (err.code == \"ER_DUP_ENTRY\") {\n                    res.status(409).send({ \"msg\": err.code });\n                    console.log('Error while performing Query.', err);\n                }\n                else res.status(400).send({ \"msg\": err.code });\n            }\n        });\n}\n\n\n\n\nexports.update = function(req, res) {\n    const codigo = req.params.cod_occurence;\n    const request = req.sanitize('id_request').escape();\n    const departure = req.sanitize('departure_time').escape();\n    const arrival = req.sanitize('arrival_time').escape();\n    const casualties = req.sanitize('n_casualties').escape();\n    const ingered = req.sanitize('n_ingered').escape();\n    const location = req.sanitize('location').escape();\n    const terrain = req.sanitize('terrain_state').escape();\n    const cost = req.sanitize('total_cost').escape();\n    const notes = req.sanitize('notes').escape();\n    var query = \"\";\n        var update = {\n            codigo,\n            request,\n            departure,\n            arrival,\n            casualties,\n            ingered,\n            location,\n            terrain,\n            cost,\n            notes\n        };\n        query = con.query('UPDATE Occurences SET cod_occurence = ?, id_request =?, departure_time=?, n_casualties=?,   n_ingered=?,    location=?,  terrain_state=?,  total_cost=?,  notes=?,  where cod_occurence=?', update, function(err, rows,\n            fields) {\n            console.log(query.sql);\n            if (!err) {\n                console.log(\"Number of records updated: \" + rows.affectedRows);\n                res.status(200).send({ \"msg\": \"update with success\" });\n            }\n            else {\n                res.status(400).send({ \"msg\": err.code });\n                console.log('Error while performing Query.', err);\n            \n        };\n    });\n}\n\n\n\n\nexports.deleteID = function(req, res) {\n    const codigo = req.params.cod_occurence;\n    const post = {\n        cod_occurence: codigo\n    };\n    con.query('DELETE from Ocurrences where cod_occurence= ?', post, function(err, rows, fields) {\n        if (!err) {\n            if (rows.length == 0) {\n                res.status(404).send({\n                    \"msg\": \"data not found\"\n                });\n            }\n            else {\n                res.status(200).send({\n                    \"msg\": \"success\"\n                });\n            }\n        }\n        else\n            console.log('Error while performing Query.', err);\n    });\n}\n","undoManager":{"mark":-2,"position":100,"stack":[[{"start":{"row":76,"column":17},"end":{"row":76,"column":18},"action":"remove","lines":["_"],"id":293},{"start":{"row":76,"column":16},"end":{"row":76,"column":17},"action":"remove","lines":["l"]},{"start":{"row":76,"column":15},"end":{"row":76,"column":16},"action":"remove","lines":["a"]},{"start":{"row":76,"column":14},"end":{"row":76,"column":15},"action":"remove","lines":["t"]},{"start":{"row":76,"column":13},"end":{"row":76,"column":14},"action":"remove","lines":["o"]},{"start":{"row":76,"column":12},"end":{"row":76,"column":13},"action":"remove","lines":["t"]}],[{"start":{"row":103,"column":4},"end":{"row":106,"column":47},"action":"remove","lines":["const name = req.sanitize('name').escape();","    const email = req.sanitize('email').escape();","    const password = req.sanitize('pass').escape();","    const iduser = req.sanitize('id').escape();"],"id":294}],[{"start":{"row":103,"column":4},"end":{"row":111,"column":49},"action":"insert","lines":["const codigo = req.sanitize('cod_occorence').escape();","    const request = req.sanitize('id_request').escape();","    const departur = req.sanitize('cod_departur').escape();","    const casualities = req.sanitize('n_casualities').escape();","    const ingered = req.sanitize('n_ingered').escape();","    const location = req.sanitize('location').escape();","    const terrain = req.sanitize('terrain_state').escape();","    const cost = req.sanitize('total_cost').escape();","    const notes = req.sanitize('notes').escape();"],"id":295}],[{"start":{"row":117,"column":12},"end":{"row":120,"column":18},"action":"remove","lines":["name,","            email,","            hash,","            iduser"],"id":296}],[{"start":{"row":117,"column":12},"end":{"row":125,"column":24},"action":"insert","lines":["cod_occorence: codigo,","            id_request: request,","            cod_departur: departur,","            n_casualities: casualities,","            n_ingered: ingered,","            location:location,","            terrain_stat:terrain,","            total_cost:cost,","            notes:notes,"],"id":297}],[{"start":{"row":117,"column":26},"end":{"row":117,"column":27},"action":"remove","lines":[" "],"id":298},{"start":{"row":117,"column":25},"end":{"row":117,"column":26},"action":"remove","lines":[":"]},{"start":{"row":117,"column":24},"end":{"row":117,"column":25},"action":"remove","lines":["e"]},{"start":{"row":117,"column":23},"end":{"row":117,"column":24},"action":"remove","lines":["c"]},{"start":{"row":117,"column":22},"end":{"row":117,"column":23},"action":"remove","lines":["n"]},{"start":{"row":117,"column":21},"end":{"row":117,"column":22},"action":"remove","lines":["e"]},{"start":{"row":117,"column":20},"end":{"row":117,"column":21},"action":"remove","lines":["r"]},{"start":{"row":117,"column":19},"end":{"row":117,"column":20},"action":"remove","lines":["o"]},{"start":{"row":117,"column":18},"end":{"row":117,"column":19},"action":"remove","lines":["c"]},{"start":{"row":117,"column":17},"end":{"row":117,"column":18},"action":"remove","lines":["c"]},{"start":{"row":117,"column":16},"end":{"row":117,"column":17},"action":"remove","lines":["o"]},{"start":{"row":117,"column":15},"end":{"row":117,"column":16},"action":"remove","lines":["_"]},{"start":{"row":117,"column":14},"end":{"row":117,"column":15},"action":"remove","lines":["d"]},{"start":{"row":117,"column":13},"end":{"row":117,"column":14},"action":"remove","lines":["o"]},{"start":{"row":117,"column":12},"end":{"row":117,"column":13},"action":"remove","lines":["c"]}],[{"start":{"row":118,"column":12},"end":{"row":118,"column":24},"action":"remove","lines":["id_request: "],"id":299}],[{"start":{"row":119,"column":11},"end":{"row":119,"column":26},"action":"remove","lines":[" cod_departur: "],"id":300}],[{"start":{"row":119,"column":11},"end":{"row":119,"column":12},"action":"insert","lines":[" "],"id":301}],[{"start":{"row":120,"column":12},"end":{"row":120,"column":27},"action":"remove","lines":["n_casualities: "],"id":303}],[{"start":{"row":121,"column":11},"end":{"row":121,"column":23},"action":"remove","lines":[" n_ingered: "],"id":304}],[{"start":{"row":121,"column":11},"end":{"row":121,"column":12},"action":"insert","lines":[" "],"id":305}],[{"start":{"row":122,"column":12},"end":{"row":122,"column":21},"action":"remove","lines":["location:"],"id":306}],[{"start":{"row":123,"column":12},"end":{"row":123,"column":25},"action":"remove","lines":["terrain_stat:"],"id":307}],[{"start":{"row":124,"column":12},"end":{"row":124,"column":23},"action":"remove","lines":["total_cost:"],"id":308}],[{"start":{"row":125,"column":11},"end":{"row":125,"column":18},"action":"remove","lines":[" notes:"],"id":309}],[{"start":{"row":125,"column":11},"end":{"row":125,"column":12},"action":"insert","lines":[" "],"id":310},{"start":{"row":125,"column":12},"end":{"row":125,"column":13},"action":"insert","lines":[" "]}],[{"start":{"row":125,"column":12},"end":{"row":125,"column":13},"action":"remove","lines":[" "],"id":311}],[{"start":{"row":114,"column":4},"end":{"row":114,"column":59},"action":"remove","lines":["bcrypt.hash(password, saltRounds).then(function(hash) {"],"id":312},{"start":{"row":114,"column":0},"end":{"row":114,"column":4},"action":"remove","lines":["    "]}],[{"start":{"row":113,"column":19},"end":{"row":114,"column":0},"action":"remove","lines":["",""],"id":313}],[{"start":{"row":63,"column":0},"end":{"row":63,"column":4},"action":"remove","lines":["    "],"id":314},{"start":{"row":62,"column":3},"end":{"row":63,"column":0},"action":"remove","lines":["",""]},{"start":{"row":62,"column":2},"end":{"row":62,"column":3},"action":"remove","lines":[" "]},{"start":{"row":62,"column":1},"end":{"row":62,"column":2},"action":"remove","lines":[" "]},{"start":{"row":62,"column":0},"end":{"row":62,"column":1},"action":"remove","lines":[" "]},{"start":{"row":61,"column":49},"end":{"row":62,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":136,"column":5},"end":{"row":136,"column":6},"action":"remove","lines":[")"],"id":315}],[{"start":{"row":137,"column":0},"end":{"row":137,"column":1},"action":"remove","lines":["}"],"id":316}],[{"start":{"row":124,"column":52},"end":{"row":124,"column":53},"action":"remove","lines":["e"],"id":317},{"start":{"row":124,"column":51},"end":{"row":124,"column":52},"action":"remove","lines":["m"]},{"start":{"row":124,"column":50},"end":{"row":124,"column":51},"action":"remove","lines":["a"]},{"start":{"row":124,"column":49},"end":{"row":124,"column":50},"action":"remove","lines":["n"]}],[{"start":{"row":124,"column":49},"end":{"row":124,"column":50},"action":"insert","lines":["c"],"id":318},{"start":{"row":124,"column":50},"end":{"row":124,"column":51},"action":"insert","lines":["o"]},{"start":{"row":124,"column":51},"end":{"row":124,"column":52},"action":"insert","lines":["d"]},{"start":{"row":124,"column":52},"end":{"row":124,"column":53},"action":"insert","lines":["_"]},{"start":{"row":124,"column":53},"end":{"row":124,"column":54},"action":"insert","lines":["o"]}],[{"start":{"row":124,"column":54},"end":{"row":124,"column":55},"action":"insert","lines":["c"],"id":319},{"start":{"row":124,"column":55},"end":{"row":124,"column":56},"action":"insert","lines":["c"]},{"start":{"row":124,"column":56},"end":{"row":124,"column":57},"action":"insert","lines":["o"]}],[{"start":{"row":124,"column":56},"end":{"row":124,"column":57},"action":"remove","lines":["o"],"id":320}],[{"start":{"row":124,"column":56},"end":{"row":124,"column":57},"action":"insert","lines":["u"],"id":321},{"start":{"row":124,"column":57},"end":{"row":124,"column":58},"action":"insert","lines":["r"]},{"start":{"row":124,"column":58},"end":{"row":124,"column":59},"action":"insert","lines":["r"]},{"start":{"row":124,"column":59},"end":{"row":124,"column":60},"action":"insert","lines":["e"]},{"start":{"row":124,"column":60},"end":{"row":124,"column":61},"action":"insert","lines":["n"]},{"start":{"row":124,"column":61},"end":{"row":124,"column":62},"action":"insert","lines":["c"]},{"start":{"row":124,"column":62},"end":{"row":124,"column":63},"action":"insert","lines":["e"]}],[{"start":{"row":124,"column":57},"end":{"row":124,"column":58},"action":"remove","lines":["r"],"id":322}],[{"start":{"row":124,"column":43},"end":{"row":124,"column":44},"action":"remove","lines":["s"],"id":323},{"start":{"row":124,"column":42},"end":{"row":124,"column":43},"action":"remove","lines":["r"]},{"start":{"row":124,"column":41},"end":{"row":124,"column":42},"action":"remove","lines":["e"]},{"start":{"row":124,"column":40},"end":{"row":124,"column":41},"action":"remove","lines":["s"]},{"start":{"row":124,"column":39},"end":{"row":124,"column":40},"action":"remove","lines":["u"]}],[{"start":{"row":124,"column":39},"end":{"row":124,"column":40},"action":"insert","lines":["O"],"id":324},{"start":{"row":124,"column":40},"end":{"row":124,"column":41},"action":"insert","lines":["c"]},{"start":{"row":124,"column":41},"end":{"row":124,"column":42},"action":"insert","lines":["c"]},{"start":{"row":124,"column":42},"end":{"row":124,"column":43},"action":"insert","lines":["o"]},{"start":{"row":124,"column":43},"end":{"row":124,"column":44},"action":"insert","lines":["r"]},{"start":{"row":124,"column":44},"end":{"row":124,"column":45},"action":"insert","lines":["e"]},{"start":{"row":124,"column":45},"end":{"row":124,"column":46},"action":"insert","lines":["n"]},{"start":{"row":124,"column":46},"end":{"row":124,"column":47},"action":"insert","lines":["c"]}],[{"start":{"row":124,"column":47},"end":{"row":124,"column":48},"action":"insert","lines":["e"],"id":325},{"start":{"row":124,"column":48},"end":{"row":124,"column":49},"action":"insert","lines":["s"]}],[{"start":{"row":124,"column":42},"end":{"row":124,"column":43},"action":"remove","lines":["o"],"id":326}],[{"start":{"row":124,"column":42},"end":{"row":124,"column":43},"action":"insert","lines":["u"],"id":327}],[{"start":{"row":124,"column":77},"end":{"row":124,"column":78},"action":"remove","lines":["l"],"id":328},{"start":{"row":124,"column":76},"end":{"row":124,"column":77},"action":"remove","lines":["i"]},{"start":{"row":124,"column":75},"end":{"row":124,"column":76},"action":"remove","lines":["a"]},{"start":{"row":124,"column":74},"end":{"row":124,"column":75},"action":"remove","lines":["m"]},{"start":{"row":124,"column":73},"end":{"row":124,"column":74},"action":"remove","lines":["e"]}],[{"start":{"row":124,"column":73},"end":{"row":124,"column":74},"action":"insert","lines":["i"],"id":329},{"start":{"row":124,"column":74},"end":{"row":124,"column":75},"action":"insert","lines":["d"]},{"start":{"row":124,"column":75},"end":{"row":124,"column":76},"action":"insert","lines":["_"]},{"start":{"row":124,"column":76},"end":{"row":124,"column":77},"action":"insert","lines":["r"]},{"start":{"row":124,"column":77},"end":{"row":124,"column":78},"action":"insert","lines":["e"]}],[{"start":{"row":124,"column":78},"end":{"row":124,"column":79},"action":"insert","lines":["q"],"id":330},{"start":{"row":124,"column":79},"end":{"row":124,"column":80},"action":"insert","lines":["u"]},{"start":{"row":124,"column":80},"end":{"row":124,"column":81},"action":"insert","lines":["e"]},{"start":{"row":124,"column":81},"end":{"row":124,"column":82},"action":"insert","lines":["s"]},{"start":{"row":124,"column":82},"end":{"row":124,"column":83},"action":"insert","lines":["t"]}],[{"start":{"row":124,"column":88},"end":{"row":124,"column":96},"action":"remove","lines":["password"],"id":331}],[{"start":{"row":124,"column":88},"end":{"row":124,"column":100},"action":"insert","lines":["cod_departur"],"id":332}],[{"start":{"row":124,"column":102},"end":{"row":124,"column":103},"action":"remove","lines":[" "],"id":333}],[{"start":{"row":124,"column":102},"end":{"row":124,"column":103},"action":"insert","lines":[","],"id":334}],[{"start":{"row":124,"column":103},"end":{"row":124,"column":104},"action":"insert","lines":[" "],"id":335}],[{"start":{"row":124,"column":104},"end":{"row":124,"column":117},"action":"insert","lines":["n_casualities"],"id":336}],[{"start":{"row":124,"column":117},"end":{"row":124,"column":118},"action":"insert","lines":["="],"id":337},{"start":{"row":124,"column":118},"end":{"row":124,"column":119},"action":"insert","lines":["?"]}],[{"start":{"row":124,"column":119},"end":{"row":124,"column":120},"action":"insert","lines":[" "],"id":338}],[{"start":{"row":124,"column":119},"end":{"row":124,"column":120},"action":"insert","lines":[","],"id":339}],[{"start":{"row":124,"column":120},"end":{"row":124,"column":121},"action":"insert","lines":[" "],"id":340}],[{"start":{"row":124,"column":121},"end":{"row":124,"column":130},"action":"insert","lines":["n_ingered"],"id":341}],[{"start":{"row":124,"column":130},"end":{"row":124,"column":131},"action":"insert","lines":["="],"id":342},{"start":{"row":124,"column":131},"end":{"row":124,"column":132},"action":"insert","lines":["?"]}],[{"start":{"row":124,"column":132},"end":{"row":124,"column":133},"action":"insert","lines":[","],"id":343}],[{"start":{"row":124,"column":133},"end":{"row":124,"column":134},"action":"insert","lines":[" "],"id":344}],[{"start":{"row":124,"column":134},"end":{"row":124,"column":142},"action":"insert","lines":["location"],"id":345}],[{"start":{"row":124,"column":142},"end":{"row":124,"column":143},"action":"insert","lines":["="],"id":346},{"start":{"row":124,"column":143},"end":{"row":124,"column":144},"action":"insert","lines":["?"]}],[{"start":{"row":124,"column":144},"end":{"row":124,"column":145},"action":"insert","lines":[","],"id":347}],[{"start":{"row":124,"column":145},"end":{"row":124,"column":146},"action":"insert","lines":[" "],"id":348},{"start":{"row":124,"column":146},"end":{"row":124,"column":147},"action":"insert","lines":["v"]}],[{"start":{"row":124,"column":146},"end":{"row":124,"column":147},"action":"remove","lines":["v"],"id":349}],[{"start":{"row":124,"column":146},"end":{"row":124,"column":159},"action":"insert","lines":["terrain_state"],"id":350}],[{"start":{"row":124,"column":159},"end":{"row":124,"column":160},"action":"insert","lines":["="],"id":351},{"start":{"row":124,"column":160},"end":{"row":124,"column":161},"action":"insert","lines":["?"]}],[{"start":{"row":124,"column":161},"end":{"row":124,"column":162},"action":"insert","lines":[","],"id":352}],[{"start":{"row":124,"column":162},"end":{"row":124,"column":163},"action":"insert","lines":[" "],"id":353}],[{"start":{"row":124,"column":163},"end":{"row":124,"column":173},"action":"insert","lines":["total_cost"],"id":354}],[{"start":{"row":124,"column":173},"end":{"row":124,"column":174},"action":"insert","lines":["="],"id":355},{"start":{"row":124,"column":174},"end":{"row":124,"column":175},"action":"insert","lines":["'"]}],[{"start":{"row":124,"column":174},"end":{"row":124,"column":175},"action":"remove","lines":["'"],"id":356}],[{"start":{"row":124,"column":174},"end":{"row":124,"column":175},"action":"insert","lines":["?"],"id":357}],[{"start":{"row":124,"column":190},"end":{"row":124,"column":191},"action":"insert","lines":[","],"id":358}],[{"start":{"row":124,"column":191},"end":{"row":124,"column":192},"action":"insert","lines":[" "],"id":359}],[{"start":{"row":124,"column":191},"end":{"row":124,"column":192},"action":"remove","lines":[" "],"id":360}],[{"start":{"row":124,"column":191},"end":{"row":124,"column":192},"action":"insert","lines":[" "],"id":361}],[{"start":{"row":124,"column":192},"end":{"row":124,"column":197},"action":"insert","lines":["notes"],"id":362}],[{"start":{"row":124,"column":197},"end":{"row":124,"column":198},"action":"insert","lines":["="],"id":363},{"start":{"row":124,"column":198},"end":{"row":124,"column":199},"action":"insert","lines":["?"]}],[{"start":{"row":124,"column":175},"end":{"row":124,"column":184},"action":"insert","lines":[", notes=?"],"id":364}],[{"start":{"row":124,"column":199},"end":{"row":124,"column":208},"action":"remove","lines":[", notes=?"],"id":365}],[{"start":{"row":124,"column":185},"end":{"row":124,"column":199},"action":"remove","lines":["where iduser=?"],"id":366}],[{"start":{"row":144,"column":8},"end":{"row":144,"column":22},"action":"remove","lines":["idUser: iduser"],"id":367}],[{"start":{"row":144,"column":8},"end":{"row":144,"column":9},"action":"insert","lines":["c"],"id":368},{"start":{"row":144,"column":9},"end":{"row":144,"column":10},"action":"insert","lines":["o"]},{"start":{"row":144,"column":10},"end":{"row":144,"column":11},"action":"insert","lines":["d"]},{"start":{"row":144,"column":11},"end":{"row":144,"column":12},"action":"insert","lines":["_"]},{"start":{"row":144,"column":12},"end":{"row":144,"column":13},"action":"insert","lines":["o"]},{"start":{"row":144,"column":13},"end":{"row":144,"column":14},"action":"insert","lines":["c"]},{"start":{"row":144,"column":14},"end":{"row":144,"column":15},"action":"insert","lines":["c"]}],[{"start":{"row":144,"column":15},"end":{"row":144,"column":16},"action":"insert","lines":["u"],"id":369}],[{"start":{"row":144,"column":8},"end":{"row":144,"column":16},"action":"remove","lines":["cod_occu"],"id":370},{"start":{"row":144,"column":8},"end":{"row":144,"column":21},"action":"insert","lines":["cod_occurence"]}],[{"start":{"row":144,"column":21},"end":{"row":144,"column":22},"action":"insert","lines":[":"],"id":371},{"start":{"row":144,"column":22},"end":{"row":144,"column":23},"action":"insert","lines":["c"]},{"start":{"row":144,"column":23},"end":{"row":144,"column":24},"action":"insert","lines":["o"]},{"start":{"row":144,"column":24},"end":{"row":144,"column":25},"action":"insert","lines":["d"]},{"start":{"row":144,"column":25},"end":{"row":144,"column":26},"action":"insert","lines":["i"]},{"start":{"row":144,"column":26},"end":{"row":144,"column":27},"action":"insert","lines":["g"]},{"start":{"row":144,"column":27},"end":{"row":144,"column":28},"action":"insert","lines":["o"]}],[{"start":{"row":144,"column":28},"end":{"row":144,"column":29},"action":"insert","lines":[","],"id":372}],[{"start":{"row":144,"column":22},"end":{"row":144,"column":23},"action":"insert","lines":[" "],"id":373}],[{"start":{"row":144,"column":29},"end":{"row":144,"column":30},"action":"remove","lines":[","],"id":374}],[{"start":{"row":101,"column":40},"end":{"row":101,"column":41},"action":"remove","lines":["o"],"id":375}],[{"start":{"row":101,"column":40},"end":{"row":101,"column":41},"action":"insert","lines":["u"],"id":376}],[{"start":{"row":101,"column":33},"end":{"row":101,"column":46},"action":"remove","lines":["cod_occurence"],"id":377},{"start":{"row":101,"column":33},"end":{"row":101,"column":46},"action":"insert","lines":["cod_occurence"]}],[{"start":{"row":53,"column":40},"end":{"row":53,"column":41},"action":"remove","lines":["o"],"id":378}],[{"start":{"row":53,"column":40},"end":{"row":53,"column":41},"action":"insert","lines":["u"],"id":379}],[{"start":{"row":66,"column":19},"end":{"row":66,"column":20},"action":"remove","lines":["o"],"id":380}],[{"start":{"row":66,"column":19},"end":{"row":66,"column":20},"action":"insert","lines":["u"],"id":381}],[{"start":{"row":78,"column":8},"end":{"row":78,"column":41},"action":"remove","lines":["console.log(\"with hash:\" + hash);"],"id":382}],[{"start":{"row":112,"column":8},"end":{"row":112,"column":41},"action":"remove","lines":["console.log(\"with hash:\" + hash);"],"id":383}],[{"start":{"row":144,"column":29},"end":{"row":144,"column":30},"action":"insert","lines":[","],"id":384}],[{"start":{"row":144,"column":29},"end":{"row":144,"column":30},"action":"remove","lines":[","],"id":385}],[{"start":{"row":144,"column":29},"end":{"row":144,"column":30},"action":"insert","lines":[";"],"id":386}],[{"start":{"row":99,"column":31},"end":{"row":99,"column":32},"action":"remove","lines":["e"],"id":387},{"start":{"row":99,"column":30},"end":{"row":99,"column":31},"action":"remove","lines":["t"]},{"start":{"row":99,"column":29},"end":{"row":99,"column":30},"action":"remove","lines":["a"]},{"start":{"row":99,"column":28},"end":{"row":99,"column":29},"action":"remove","lines":["d"]},{"start":{"row":99,"column":27},"end":{"row":99,"column":28},"action":"remove","lines":["p"]},{"start":{"row":99,"column":26},"end":{"row":99,"column":27},"action":"remove","lines":["u"]}],[{"start":{"row":140,"column":33},"end":{"row":140,"column":34},"action":"remove","lines":["D"],"id":388},{"start":{"row":140,"column":32},"end":{"row":140,"column":33},"action":"remove","lines":["I"]},{"start":{"row":140,"column":31},"end":{"row":140,"column":32},"action":"remove","lines":["e"]},{"start":{"row":140,"column":30},"end":{"row":140,"column":31},"action":"remove","lines":["t"]},{"start":{"row":140,"column":29},"end":{"row":140,"column":30},"action":"remove","lines":["e"]},{"start":{"row":140,"column":28},"end":{"row":140,"column":29},"action":"remove","lines":["l"]},{"start":{"row":140,"column":27},"end":{"row":140,"column":28},"action":"remove","lines":["e"]}],[{"start":{"row":140,"column":26},"end":{"row":140,"column":27},"action":"remove","lines":["d"],"id":389}],[{"start":{"row":140,"column":9},"end":{"row":140,"column":10},"action":"remove","lines":["a"],"id":390}],[{"start":{"row":140,"column":9},"end":{"row":140,"column":10},"action":"insert","lines":["e"],"id":391}],[{"start":{"row":51,"column":27},"end":{"row":51,"column":28},"action":"remove","lines":["e"],"id":392},{"start":{"row":51,"column":26},"end":{"row":51,"column":27},"action":"remove","lines":["v"]},{"start":{"row":51,"column":25},"end":{"row":51,"column":26},"action":"remove","lines":["a"]},{"start":{"row":51,"column":24},"end":{"row":51,"column":25},"action":"remove","lines":["s"]}],[{"start":{"row":0,"column":0},"end":{"row":164,"column":0},"action":"remove","lines":["const con = require(\"../config/connect\");","const bcrypt = require(\"bcrypt\");","const saltRounds = 10;","","","exports.read = function(req, res) {","","","    con.query('SELECT * from Citizens', function(err, rows, fields) {","        if (!err) {","","            if (rows.length == 0) {","                res.status(404).send(\"Data not found\");","            }","            else {","                res.status(200).send(rows);","            }","        }","        else","            console.log('Error while performing Query.', err);","    });","}","","","exports.readID = function(req, res) {","","    const iduser = req.sanitize('id').escape();","    const post = {","        idUser: iduser","    };","    con.query('SELECT * from Occurrences order by dateReg desc', post, function(err, rows, fields) {","        if (!err) {","","            if (rows.length == 0) {","                res.status(404).send({","                    \"msg\": \"data not found\"","                });","            }","            else {","                res.status(200).send(rows);","            }","        }","        else","            res.status(400).send({","                \"msg\": err.code","            });","        console.log('Error while performing Query.', err);","    });","}","","//função de gravação que recebe os 3 parâmetros","exports.save = function (req, res) {","    //receber os dados do formuário que são enviados por post","    const codigo = req.sanitize('cod_occurence').escape();","    const request = req.sanitize('id_request').escape();","    const departur = req.sanitize('cod_departur').escape();","    const casualities = req.sanitize('n_casualities').escape();","    const ingered = req.sanitize('n_ingered').escape();","    const location = req.sanitize('location').escape();","    const terrain = req.sanitize('terrain_state').escape();","    const cost = req.sanitize('total_cost').escape();","    const notes = req.sanitize('notes').escape();","    console.log(\"without hahsh:\" + req.body.pass);","    var query = \"\";","    ","        var post = {","            cod_occurence: codigo,","            id_request: request,","            cod_departur: departur,","            n_casualities: casualities,","            n_ingered: ingered,","            location:location,","            terrain_stat:terrain,","            total_cost:cost,","            notes:notes,","        };","","","        ","        query = con.query('INSERT INTO users SET ?', post, function(err, rows, fields) {","            console.log(query.sql);","            if (!err) {","                res.status(200).location(rows.insertId).send({","                    \"msg\": \"inserted with success\"","                });","                console.log(\"Number of records inserted: \" + rows.affectedRows);","            }","            else {","                if (err.code == \"ER_DUP_ENTRY\") {","                    res.status(409).send({ \"msg\": err.code });","                    console.log('Error while performing Query.', err);","                }","                else res.status(400).send({ \"msg\": err.code });","            }","        });","    };","","","//efetuar updade de todos os dados para um determinado iduser","exports.update = function (req, res) {","    //receber os dados do formuário que são enviados por post","    const codigo = req.sanitize('cod_occurence').escape();","    const request = req.sanitize('id_request').escape();","    const departur = req.sanitize('cod_departur').escape();","    const casualities = req.sanitize('n_casualities').escape();","    const ingered = req.sanitize('n_ingered').escape();","    const location = req.sanitize('location').escape();","    const terrain = req.sanitize('terrain_state').escape();","    const cost = req.sanitize('total_cost').escape();","    const notes = req.sanitize('notes').escape();","    console.log(\"without hahsh:\" + req.body.pass);","    var query = \"\";","        ","        var update = {","            codigo,","            request,","            departur,","            casualities,","            ingered,","            location,","            terrain,","            cost,","            notes,","        };","        query = con.query('INSERT INTO Occurences SET cod_occurence = ?, id_request =?, cod_departur=?, n_casualities=?, n_ingered=?, location=?, terrain_state=?, total_cost=?, notes=? ', update, function(err, rows,","            fields) {","            console.log(query.sql);","            if (!err) {","                console.log(\"Number of records updated: \" + rows.affectedRows);","                res.status(200).send({ \"msg\": \"update with success\" });","            }","            else {","                res.status(400).send({ \"msg\": err.code });","                console.log('Error while performing Query.', err);","            }","        });","    };","","","//função que apaga todos os dados de um iduser","exports.delete = function (req, res) {","    //criar e executar a query de leitura na BD","    const iduser = req.sanitize('id').escape();","    const post = {","        cod_occurence: codigo;","    };","    con.query('DELETE from users where iduser = ?', post, function(err, rows, fields) {","        if (!err) {","            //verifica os resultados se o número de linhas for 0 devolve dados não encontrados, caso contrário envia os resultados (rows).","            if (rows.length == 0) {","                res.status(404).send({","                    \"msg\": \"data not found\"","                });","            }","            else {","                res.status(200).send({","                    \"msg\": \"success\"","                });","            }","        }","        else","            console.log('Error while performing Query.', err);","    });","}",""],"id":393}],[{"start":{"row":0,"column":0},"end":{"row":160,"column":0},"action":"insert","lines":["//função de leitura que retorna o resultado no callback","","const con = require(\"../config/connect\");","","","exports.read = function(req, res) {","","","    con.query('SELECT * from Occurrences', function(err, rows, fields) {","        if (!err) {","","            if (rows.length == 0) {","                res.status(404).send(\"Data nao encontrada\");","            }","            else {","                res.status(200).send(rows);","            }","        }","        else","            console.log('Error while performing Query.', err);","    });","}","","","exports.readID = function(req, res) {","","    const codigo = req.params.cod_occurence;","    const post = {","        cod_occurence: codigo","    };","    con.query('SELECT * from Occurrences where cod_occurence=?', post, function(err, rows, fields) {","        if (!err) {","","            if (rows.length == 0) {","                res.status(404).send({","                    \"msg\": \"data not found\"","                });","            }","            else {","                res.status(200).send(rows);","            }","        }","        else","            res.status(400).send({","                \"msg\": err.code","            });","        console.log('Error while performing Query.', err);","    });","}","","","exports.save = function(req, res) {","    const codigo = req.params.cod_occurence;","    const request = req.sanitize('id_request').escape();","    const departure = req.sanitize('departure_time').escape();","    const arrival = req.sanitize('arrival_time').escape();","    const casualties = req.sanitize('n_casualties').escape();","    const ingered = req.sanitize('n_ingered').escape();","    const location = req.sanitize('location').escape();","    const terrain = req.sanitize('terrain_state').escape();","    const cost = req.sanitize('total_cost').escape();","    const notes = req.sanitize('notes').escape();","    var query = \"\";","        var post = {","            cod_occurrence: codigo,","            id_request: request,","            departure_time: departure,","            arrival_time: arrival,","            n_casualties: casualties,","            n_ingered: ingered,","            location: location,","            terrain_state: terrain,","            total_cost: cost,","            notes: notes","        }","        query = con.query('INSERT INTO Occurrences SET ?', post, function(err, rows, fields) {","            console.log(query.sql);","            if (!err) {","                res.status(200).location(rows.insertId).send({","                    \"msg\": \"inserted with success\"","                });","                console.log(\"Number of records inserted: \" + rows.affectedRows);","            }","            else {","                if (err.code == \"ER_DUP_ENTRY\") {","                    res.status(409).send({ \"msg\": err.code });","                    console.log('Error while performing Query.', err);","                }","                else res.status(400).send({ \"msg\": err.code });","            }","        });","}","","","","","exports.update = function(req, res) {","    const codigo = req.params.cod_occurence;","    const request = req.sanitize('id_request').escape();","    const departure = req.sanitize('departure_time').escape();","    const arrival = req.sanitize('arrival_time').escape();","    const casualties = req.sanitize('n_casualties').escape();","    const ingered = req.sanitize('n_ingered').escape();","    const location = req.sanitize('location').escape();","    const terrain = req.sanitize('terrain_state').escape();","    const cost = req.sanitize('total_cost').escape();","    const notes = req.sanitize('notes').escape();","    var query = \"\";","        var update = {","            codigo,","            request,","            departure,","            arrival,","            casualties,","            ingered,","            location,","            terrain,","            cost,","            notes","        };","        query = con.query('UPDATE Occurences SET cod_occurence = ?, id_request =?, departure_time=?, n_casualties=?,   n_ingered=?,    location=?,  terrain_state=?,  total_cost=?,  notes=?,  where cod_occurence=?', update, function(err, rows,","            fields) {","            console.log(query.sql);","            if (!err) {","                console.log(\"Number of records updated: \" + rows.affectedRows);","                res.status(200).send({ \"msg\": \"update with success\" });","            }","            else {","                res.status(400).send({ \"msg\": err.code });","                console.log('Error while performing Query.', err);","            ","        };","    });","}","","","","","exports.deleteID = function(req, res) {","    const codigo = req.params.cod_occurence;","    const post = {","        cod_occurence: codigo","    };","    con.query('DELETE from Ocurrences where cod_occurence= ?', post, function(err, rows, fields) {","        if (!err) {","            if (rows.length == 0) {","                res.status(404).send({","                    \"msg\": \"data not found\"","                });","            }","            else {","                res.status(200).send({","                    \"msg\": \"success\"","                });","            }","        }","        else","            console.log('Error while performing Query.', err);","    });","}",""],"id":394}]]},"ace":{"folds":[],"scrolltop":1875,"scrollleft":0,"selection":{"start":{"row":160,"column":0},"end":{"row":160,"column":0},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":124,"state":"start","mode":"ace/mode/javascript"}},"timestamp":1607770607127}